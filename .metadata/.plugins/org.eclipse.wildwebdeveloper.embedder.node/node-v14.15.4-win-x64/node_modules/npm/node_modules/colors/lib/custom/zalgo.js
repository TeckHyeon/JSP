// please no
module['exports'] = function zalgo(text, options) {
  text = text || '   he is here   ';
  var soul = {
    'up': [
      '?', '?', '?', '?',
      '結', '?', '?', '?',
      '?', '?', '?', '?',
      '?', '?', '?', '?',
      '?', '?', '?', '?',
      '?', '?', '?', '?',
      '?', '?', '?', '?',
      '?', '?', '?', '決',
      '?', '界', '癸', '磎',
      '稽', '系', '繫', '繼',
      '計', '誡', '谿', '階',
      '鷄', '古', '潔', '?',
      '?', '?',
    ],
    'down': [
      '?', '?', '?', '?',
      '?', '?', '?', '?',
      '?', '劫', '怯', '迲',
      '揭', '擊', '格', '檄',
      '激', '膈', '覡', '隔',
      '堅', '牽', '犬', '譴',
      '遣', '鵑', '抉', '?',
      '?', '?', '?', '?',
      '?', '?', '?', '?',
      '?', '?', '?', '黔',
    ],
    'mid': [
      '?', '?', '?', '?',
      '?', '瞼', '鈐', '偈',
      '憩', '甄', '絹', '繭',
      '?', '?', '?',
      '?', '?', '溪', '見',
      '肩', '棨', ' ?',
    ],
  };
  var all = [].concat(soul.up, soul.down, soul.mid);

  function randomNumber(range) {
    var r = Math.floor(Math.random() * range);
    return r;
  }

  function isChar(character) {
    var bool = false;
    all.filter(function(i) {
      bool = (i === character);
    });
    return bool;
  }


  function heComes(text, options) {
    var result = '';
    var counts;
    var l;
    options = options || {};
    options['up'] =
      typeof options['up'] !== 'undefined' ? options['up'] : true;
    options['mid'] =
      typeof options['mid'] !== 'undefined' ? options['mid'] : true;
    options['down'] =
      typeof options['down'] !== 'undefined' ? options['down'] : true;
    options['size'] =
      typeof options['size'] !== 'undefined' ? options['size'] : 'maxi';
    text = text.split('');
    for (l in text) {
      if (isChar(l)) {
        continue;
      }
      result = result + text[l];
      counts = {'up': 0, 'down': 0, 'mid': 0};
      switch (options.size) {
        case 'mini':
          counts.up = randomNumber(8);
          counts.mid = randomNumber(2);
          counts.down = randomNumber(8);
          break;
        case 'maxi':
          counts.up = randomNumber(16) + 3;
          counts.mid = randomNumber(4) + 1;
          counts.down = randomNumber(64) + 3;
          break;
        default:
          counts.up = randomNumber(8) + 1;
          counts.mid = randomNumber(6) / 2;
          counts.down = randomNumber(8) + 1;
          break;
      }

      var arr = ['up', 'mid', 'down'];
      for (var d in arr) {
        var index = arr[d];
        for (var i = 0; i <= counts[index]; i++) {
          if (options[index]) {
            result = result + soul[index][randomNumber(soul[index].length)];
          }
        }
      }
    }
    return result;
  }
  // don't summon him
  return heComes(text, options);
};

